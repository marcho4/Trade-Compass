# Описание проекта Trade Compass

## Архитектура

Архитектура микросервисная. База данных сейчас одна на все микросервисы. Так сделано специально.
Разработка проекта ведется в единственной ветке master. Для создания фичи или какой-то более менее серьезной/весомой доработки надо создать ветку командой git checkout -b \<feature> и работать уже в ней, затем мержить в master.
Не пиши .md документы с отчетами после завершения задачи - это бесполезно.

## Сервисы

### Parser

Сервис рассчитан на то, чтобы принимать отчеты и другие пдфки с полезной информацией извне и сохранять их в S3 хранилище.
S3 хранилище находится в Yandex Cloud. Есть ручка /start_parsing, которая запускает парсинг сайта e-disclosure.
В Postgres в таблице reports лежат данные о том, по какой ссылке лежат отчеты. Это чтобы AI service мог получить все ссылки и скачать к себе файлы в стейт из S3. Если в S3 уже есть отчет, то сервис его скипнет.

Для тестов используется pytest, для работы с Postgres работает ORM SqlAlchemy.

Парсер преобразует текст pdf отчетов в Embeddings размерностью 3072, чтобы затем сохранить их в Qdrant для векторного поиска вопросов в чате.

Вместо того, чтобы возвращать кучу словарей разных из одного метода, нужно создать датакласс в слое domain и его использовать для хранения результата обработки функции, чтобы было понятно что откуда придет и что куда совать.

Краткое описание процессинга отчета:

1. Скачивание
2. Парсинг метаданных об отчете
3. Анзиппинг и сохранение пдф в файловую систему
4. Загрузка в S3
5. Загрузка в БД
6. Векторизация отчета в базу данных Qdrant

### Auth Service

Сервис отвечает за регистрацию и авторизацию пользователей в приложении. Также он генерирует JWT access/refresh токены для доступа к защищенным API Rout'ам.
Сервис реализует интеграцию с OIDC Yandex, чтобы пользователи могли войти через аккаунт в яндексе.

### Ai Service

В качестве AI api был выбран Gemini от Google. Gemini 3 Pro для ресерча компаний, Gemini 3 Flash для чата с пользователем. Сервис является ключевым в Trade Compass.

Сервис должен выполнять следующие функции:
- Создавать чаты с нейросетью для пользователей
- Генерировать фундаментальный анализ по фреймворку MorningStar с учетом контекста данных из financial data сервиса и рассчета справедливой оценки по FCFF.
- Рассчет справедливой оценки по FCFF.
- Подтягивать в контекст чатов данные из векторной бд с распаршенными отчетами компаний для быстрого поиска информации в отчетах.

### Financial Data Service

Данный сервис написан на Go. Он предоставляет доступ приложения к разным финансовым данным.

Список предоставляемых данных:

1. Цена акций на бирже MOEX
2. Разные Ratios компаний
3. AVG по сектору для всех Ratios
4. Базовая информация о компаниях
5. Ставка ЦБ РФ за последние 10 лет
6. Новости о компаниях/секторах (пока не реализовано)

Данные нужны приложению для обогащения контекста AI при проведении фундаментального анализа акции. Данные хранятся в PostgreSQL. 
Оператор может вручную загружать данные, потому что источников данных пока нет. 

В планах у сервиса предоставлять следующую информацию:
- Средняя годовая доходность роста цен квартир в Москве, Питере, еще парочке крупных городов и по всей России.
- Рассчет доходности от сдачи квартиры в аренду за 5 лет. Берем усредненные данные по России.
Эти данные нужны будут для реализации фичи: Квартира VS Акции
