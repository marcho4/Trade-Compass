# Роадмап проекта Bull Run

## Общая стратегия

Разработка будет вестись итеративно с фокусом на быстрый запуск MVP и постепенное добавление функционала. Приоритет - создать работающий продукт для 3-5 компаний с ручным вводом данных, затем масштабировать.

---

## Phase 0: Подготовка инфраструктуры (1-2 недели)

### 0.1 Настройка окружения разработки
- [ ] Создать основную структуру монорепозитория
- [ ] Настроить Docker Compose для локальной разработки
- [ ] Настроить PostgreSQL локально и в Docker
- [ ] Создать .env файлы для конфигурации
- [ ] Настроить Makefile для общих команд

### 0.2 Инициализация сервисов
- [ ] Создать структуру Go сервиса (metrics-service)
- [ ] Создать структуру Next.js приложения (frontend)
- [ ] Улучшить структуру Python сервиса (parser)
- [ ] Настроить .gitignore для всех сервисов

### 0.3 CI/CD базовый
- [ ] Создать GitHub Actions для линтинга
- [ ] Настроить базовые тесты для каждого сервиса
- [ ] Подготовить deployment скрипты для Hetzner (без деплоя)

**Результат Phase 0**: Рабочее окружение для разработки всех компонентов локально

---

## Phase 1: MVP Backend - База данных и API (2-3 недели)

### 1.1 Финализация схемы базы данных
- [ ] Расширить схему database.md с полным списком таблиц:
  - companies (расширить поля: название, описание, website)
  - sectors, industries (добавить таблицу industries)
  - reports (добавить тип отчета, статус обработки)
  - financial_metrics (все метрики по периодам)
  - stock_prices (исторические цены)
  - industry_metrics (агрегированные метрики по индустриям)
  - sector_metrics (агрегированные метрики по секторам)
  - users (для авторизации)
  - subscriptions (планы подписок)
  - ai_usage (трекинг использования AI)

- [ ] Создать SQL миграции через golang-migrate или goose
- [ ] Применить миграции и создать базу данных
- [ ] Наполнить справочники: sectors, industries

### 1.2 Go Backend - Metrics Service
- [ ] Настроить фреймворк (рекомендую Gin или Fiber)
- [ ] Подключить PostgreSQL через pgx или GORM
- [ ] Создать основные модели данных (structs)

**API эндпоинты v1:**
- [ ] GET /api/v1/companies - список компаний
- [ ] GET /api/v1/companies/:ticker - детали компании
- [ ] GET /api/v1/companies/:ticker/metrics - метрики компании по периодам
- [ ] GET /api/v1/companies/:ticker/price-history - история цен
- [ ] GET /api/v1/industries/:id/metrics - метрики индустрии
- [ ] GET /api/v1/sectors/:id/metrics - метрики сектора
- [ ] GET /api/v1/companies/:ticker/reports - список отчетов компании

### 1.3 Сервис расчета метрик
- [ ] Создать калькулятор для всех метрик из business.md
- [ ] Написать функции расчета: P/E, P/BV, ROE, ROA, ROIC и т.д.
- [ ] Создать cronjob для пересчета метрик по индустриям
- [ ] Создать cronjob для пересчета метрик по секторам

### 1.4 Интеграция с MOEX API
- [ ] Изучить MOEX ISS API документацию
- [ ] Создать клиент для получения котировок
- [ ] Создать cronjob для обновления цен акций (каждые 5-15 минут в торговые часы)
- [ ] Сохранение исторических данных в stock_prices

### 1.5 Ручной ввод данных для MVP
- [ ] Создать SQL скрипты для ввода данных компаний вручную
- [ ] Заполнить данные для 3-5 компаний (Сбер, Яндекс, Лукойл, Газпром, ВТБ)
- [ ] Ввести финансовые метрики за последние 4-8 кварталов
- [ ] Проверить корректность расчетов всех показателей

**Результат Phase 1**: Работающий API для получения данных по компаниям, метрики считаются автоматически, цены обновляются

---

## Phase 2: MVP Frontend - Визуализация данных (3-4 недели)

### 2.1 Базовая настройка Next.js
- [ ] Создать Next.js 14+ проект (App Router)
- [ ] Настроить TypeScript strict mode
- [ ] Установить Shadcn UI и настроить тему
- [ ] Настроить Tailwind CSS
- [ ] Создать базовый layout и navigation

### 2.2 Страницы и роутинг
- [ ] Главная страница (/) - список компаний с базовой информацией
- [ ] Страница компании (/companies/[ticker]) - детальная информация
- [ ] Страница "О проекте" (/about)
- [ ] Страница с планами подписок (/pricing) - статичная пока

### 2.3 Компоненты для метрик (Страница компании)
**Раздел 1: Обзор компании**
- [ ] Header с названием, логотипом, тикером, текущей ценой
- [ ] Основная информация: сектор, индустрия, описание
- [ ] Ключевые метрики в карточках: P/E, P/BV, ROE, Market Cap

**Раздел 2: Value метрики**
- [ ] Карточка с P/E, P/S, P/B
- [ ] Сравнение с индустрией (визуальные индикаторы)
- [ ] Интерпретация значений (цветовая индикация)

**Раздел 3: Прибыльность**
- [ ] График выручки и прибыли (Chart.js или Recharts)
- [ ] Показатели: ROE, ROA, Margins
- [ ] Сравнение с отраслью
- [ ] Темпы роста (Revenue Growth Rate, Industry Growth Rate)

**Раздел 4: Денежные потоки**
- [ ] График: Operating Cash Flow, Free Cash Flow, CAPEX
- [ ] Таблица по периодам
- [ ] Income Quality метрика

**Раздел 5: Долговая нагрузка**
- [ ] Debt to Equity график
- [ ] Interest Coverage Ratio
- [ ] Карта долгов (визуализация структуры: активы/обязательства)
- [ ] Breakdown: Cash, Equity, Total Liabilities, Total Assets

**Раздел 6: Дивиденды** (если применимо)
- [ ] История выплат дивидендов (график)
- [ ] Сравнение с отраслью и рынком
- [ ] Payout ratio (% от прибыли на дивиденды)

**Раздел 7: Отчеты**
- [ ] Список доступных отчетов
- [ ] Ссылки на скачивание
- [ ] Статус обработки

### 2.4 Визуализация и UX
- [ ] Создать библиотеку графиков (line, bar, area charts)
- [ ] Добавить tooltips с объяснениями метрик
- [ ] Адаптивная верстка (mobile-first)
- [ ] Темная/светлая тема
- [ ] Loading states и skeleton screens
- [ ] Error handling и fallbacks

### 2.5 Интеграция с Backend
- [ ] Настроить API клиент (fetch или axios)
- [ ] Реализовать server-side rendering для SEO
- [ ] Кэширование данных (Next.js cache или SWR)

**Результат Phase 2**: Полноценный интерфейс для просмотра аналитики по компаниям без AI функционала

---

## Phase 3: AI Интеграция (2-3 недели)

### 3.1 Backend для AI
- [ ] Создать Go сервис или добавить в metrics-service
- [ ] Интегрировать Claude API (Anthropic SDK)
- [ ] Создать систему промптов:
  - Базовый промпт с описанием метрик
  - Промпт для анализа компании
  - Промпт для summary годового отчета
  - Промпт для быстрых проверок

### 3.2 Управление контекстом
- [ ] Логика формирования контекста для Claude:
  - Все метрики компании по периодам
  - Последний годовой отчет
  - Последний квартальный отчет (если не совпадает)
  - Метрики индустрии для сравнения
- [ ] Prompt caching для оптимизации стоимости
- [ ] Управление размером контекста (token limits)

### 3.3 API эндпоинты для AI
- [ ] POST /api/v1/ai/chat - чат с AI о компании
- [ ] POST /api/v1/ai/analyze/:ticker - полный анализ
- [ ] POST /api/v1/ai/quick-check/:ticker - быстрая проверка
- [ ] GET /api/v1/ai/summary/:ticker - AI summary отчета
- [ ] GET /api/v1/ai/explain/:term - объяснение термина

### 3.4 Система лимитов и учета
- [ ] Создать middleware для проверки лимитов
- [ ] Трекинг использования AI в таблице ai_usage
- [ ] Логика лимитов для Free/Essential/Professional
- [ ] Rate limiting

### 3.5 Frontend для AI
- [ ] Чат интерфейс на странице компании (sidebar или modal)
- [ ] Кнопка "Анализ с AI" - запуск полного анализа
- [ ] Кнопка "Быстрая проверка"
- [ ] AI Summary секция (для годового отчета)
- [ ] Tooltips с AI объяснениями терминов
- [ ] Показ оставшихся лимитов
- [ ] История чата (сохранение в localStorage или БД)

### 3.6 Тестирование AI
- [ ] Проверить качество ответов на типовых вопросах
- [ ] Оптимизировать промпты
- [ ] Измерить среднюю стоимость анализа
- [ ] Проверить работу кэширования

**Результат Phase 3**: Работающая AI интеграция с чатом и аналитикой

---

## Phase 4: Авторизация и Монетизация (2 недели)

### 4.1 Система авторизации
- [ ] Выбрать решение: NextAuth.js или Supabase Auth
- [ ] Регистрация пользователей (email + password)
- [ ] Вход в систему
- [ ] Восстановление пароля
- [ ] Email верификация

### 4.2 Подписки и платежи
- [ ] Интеграция с ЮKassa или CloudPayments
- [ ] Создание логики подписок в БД
- [ ] Endpoint для создания подписки
- [ ] Webhook для обработки платежей
- [ ] Личный кабинет: активная подписка, история платежей

### 4.3 Middleware и защита роутов
- [ ] Проверка авторизации на защищенных эндпоинтах
- [ ] Проверка уровня подписки
- [ ] Ограничение доступа к AI функциям по тарифу

### 4.4 Pay-per-analysis
- [ ] Endpoint для единичной покупки анализа
- [ ] UI для покупки (modal с оплатой)
- [ ] Учет single purchases в БД

**Результат Phase 4**: Пользователи могут регистрироваться и покупать подписки

---

## Phase 5: Парсер отчетов (Python) (3-4 недели)

### 5.1 Сканирование e-disclosure.ru
- [ ] Создать парсер для получения списка отчетов по ИНН
- [ ] Скачивание PDF/XBRL файлов
- [ ] Сохранение в объектное хранилище (S3-compatible, например Backblaze B2)
- [ ] Запись метаданных в таблицу reports

### 5.2 Извлечение данных из отчетов
- [ ] Конвертация PDF в текст (PyPDF2 или pdfplumber)
- [ ] Парсинг XBRL файлов (если доступны)
- [ ] Извлечение финансовых показателей через регулярки или NLP
- [ ] Валидация извлеченных данных

### 5.3 Автоматическое наполнение БД
- [ ] Сохранение извлеченных метрик в financial_metrics
- [ ] Обновление данных компаний
- [ ] Логирование ошибок парсинга
- [ ] Dashboard для мониторинга парсинга

### 5.4 Cron job
- [ ] Запуск парсера раз в день
- [ ] Проверка новых отчетов
- [ ] Уведомления об ошибках

**Результат Phase 5**: Автоматическое обновление данных из отчетов, уход от ручного ввода

---

## Phase 6: Расширенные фичи (3-4 недели)

### 6.1 Портфель пользователя
- [ ] Таблица user_portfolios, portfolio_positions
- [ ] Добавление акций в портфель
- [ ] Расчет текущей стоимости портфеля
- [ ] Визуализация распределения активов

### 6.2 Ребалансировка портфеля (AI)
- [ ] Промпт для анализа портфеля
- [ ] API endpoint /api/v1/ai/rebalance
- [ ] UI для показа рекомендаций
- [ ] Объяснение почему нужна ребалансировка

### 6.3 Алерты и уведомления
- [ ] Подписка на алерты по компаниям
- [ ] Email уведомления о новых отчетах
- [ ] Уведомления о значительных изменениях метрик

### 6.4 Сравнение компаний
- [ ] Страница для сравнения 2-4 компаний
- [ ] Side-by-side метрики
- [ ] Графики для сравнения

### 6.5 Скринер акций
- [ ] Фильтры по метрикам (P/E < X, ROE > Y)
- [ ] Сортировка компаний
- [ ] Экспорт результатов

**Результат Phase 6**: Расширенные функции для продвинутых пользователей

---

## Phase 7: Масштабирование и оптимизация (2-3 недели)

### 7.1 Production инфраструктура
- [ ] Deploy на Hetzner
- [ ] Настроить Nginx как reverse proxy
- [ ] SSL сертификаты (Let's Encrypt)
- [ ] Настроить домен

### 7.2 Мониторинг и логирование
- [ ] Установить Prometheus + Grafana
- [ ] Метрики: latency, error rate, throughput
- [ ] Алерты в Telegram при ошибках
- [ ] Логирование в файлы + rotation

### 7.3 Производительность
- [ ] Кэширование на уровне API (Redis опционально)
- [ ] Оптимизация SQL запросов (индексы)
- [ ] CDN для статики фронтенда
- [ ] Lazy loading для изображений

### 7.4 Безопасность
- [ ] Rate limiting на всех эндпоинтах
- [ ] Защита от SQL injection (prepared statements)
- [ ] Sanitization user input
- [ ] Регулярные бэкапы БД

### 7.5 API для Professional подписки
- [ ] Генерация API ключей
- [ ] Documentation (Swagger/OpenAPI)
- [ ] Rate limiting для API

**Результат Phase 7**: Продакшн-ready приложение с мониторингом

---

## Phase 8: Маркетинг и запуск (ongoing)

### 8.1 SEO оптимизация
- [ ] Meta tags для всех страниц
- [ ] Sitemap.xml
- [ ] robots.txt
- [ ] Структурированные данные (JSON-LD)

### 8.2 Контент
- [ ] Статьи в блог про метрики
- [ ] Tutorial videos
- [ ] Use cases и примеры

### 8.3 Аналитика
- [ ] Яндекс.Метрика интеграция
- [ ] Отслеживание конверсий
- [ ] A/B тесты для pricing page

### 8.4 Маркетинг
- [ ] Посты в тематических Telegram каналах
- [ ] Reddit r/investinrussia
- [ ] Партнерство с инвест-блогерами
- [ ] Бесплатный период для первых пользователей

**Результат Phase 8**: Приток первых платящих пользователей

---

## Приоритеты для старта

### Первый спринт (2 недели) - Минимальный MVP
1. Phase 0 - инфраструктура
2. Phase 1.1-1.2 - база данных и базовый API
3. Phase 1.5 - ручной ввод данных для 3 компаний

### Второй спринт (2 недели) - Интерфейс
4. Phase 2.1-2.3 - фронтенд с основными метриками
5. Phase 1.3 - калькулятор метрик

### Третий спринт (2 недели) - AI
6. Phase 3 - интеграция Claude

### Четвертый спринт (2 недели) - Монетизация
7. Phase 4 - авторизация и подписки
8. Phase 7.1 - деплой на прод

### Далее
9. Phase 5 - автоматический парсер
10. Phase 6 - расширенные фичи
11. Phase 7 - оптимизация
12. Phase 8 - маркетинг

---

## Метрики успеха

### Технические
- Uptime > 99%
- API latency < 200ms (p95)
- Парсер обрабатывает 95%+ отчетов успешно
- Стоимость AI анализа < 15 руб

### Бизнес (первые 3 месяца)
- 100+ зарегистрированных пользователей
- 10+ платящих пользователей
- 50+ активных пользователей/месяц
- Retention rate > 40%

### Продуктовые
- 20+ компаний в базе
- Данные за последние 2 года
- 5+ use cases в документации
